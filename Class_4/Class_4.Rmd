---
title: "Econometria I"
subtitle: "<br/> Regresión Lineal Simple"
author: "PhD.(C) Orlando Joaqui-Barandica"
institute: "Pontificia Universidad Javeriana de Cali"
date: "2023"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: 
      - default
      - rladies
      - rladies-fonts
      - fonts_mtheme.css
    includes:
      in_header: "mathjax-equation-numbers.html"
    seal: false  
    nature: 
      ratio: 16:9
      beforeInit: "macros.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include = FALSE}
library(knitr)                              # paquete que trae funciones utiles para R Markdown
library(tidyverse)                          # paquete que trae varios paquetes comunes en el tidyverse
library(datos)                              # paquete que viene con datos populares traducidos al español :)
library(shiny)
# opciones predeterminadas
knitr::opts_chunk$set(echo = FALSE,         # FALSE: los bloques de código NO se muestran
                      dpi = 300,            # asegura gráficos de alta resolución
                      warning = FALSE,      # los mensajes de advertencia NO se muestran
                      error = FALSE)        # los mensajes de error NO se muestran


options(htmltools.dir.version = FALSE)

library(xaringan)

```

class: inverse, left, bottom
background-image: url("img/fondo.jpg")
background-size: cover


# **`r rmarkdown::metadata$title`**
----

## **`r rmarkdown::metadata$subtitle`**

### `r rmarkdown::metadata$author`
### `r rmarkdown::metadata$date`

```{r xaringanExtra-share-again, echo=FALSE}
xaringanExtra::use_share_again()
```

```{r xaringanExtra-clipboard, echo=FALSE}
xaringanExtra::use_clipboard()
```

---
name: hola
class: inverse, middle, center

<img style="border-radius: 60%;" src="img/jave.jpg"
width="150px"
/>

# Pontificia Universidad Javeriana de Cali

--

## Programa de Economía
---




.pull-left[

<br><br><br><br><br>

```{r echo=FALSE, out.width = "110%" }
knitr::include_graphics("img/gif1.gif")
```
]

<br><br><br><br><br>


.pull-right[
# Orlando Joaqui-Barandica
### [www.joaquibarandica.com](https://www.joaquibarandica.com)
 *PhD.(C) in Industrial Engineering* 
 
 *MSc. Applied Economics*
 
 *BSc. Statistics*
]

---

name: menu
background-image: url("img/back2.jpg")
background-size: cover
class: left, middle, inverse

# Contenido

----


.pull-left[

### `r icon("dice-d6")` [FRP y FRM](#FRP)

### `r icon("database")` [X fija o aleatoria?](#fija)

### `r icon("dice-d6")` [Precisión de los estimadores](#precision)

]


.pull-right[



### `r icon("upload")` [Estimación de $\sigma^2$](#varianza)

### `r icon("broom")` [Regresión a través del origen](#origen)


### `r icon("sort-numeric-up")` [Distr. de prob. de $u_i$](#ui)



]

---


name: FRP
class: inverse, center, middle

# `r icon("dice-d6")`
# FRP y FRM
----

.right[
.bottom[
####  [`r icon("bell")`](#menu)
]
]

---

# Recordemos...


### Función de regresión poblacional (FRP)

Es una función lineal de $x$. Dado cualquier valor de $x$, la distribución de $y$ está centrada en $E(y|x)$ 

$$E(y|x) =\beta_0 + \beta_1x$$


### Función de regresión muestral (FRM)

Una vez que se han determinado las estimaciones por MCO del intercepto y de la pendiente, se obtiene la línea de regresión de MCO.

$$ \hat{y} = \hat{\beta_0} + \hat{\beta_1}x$$


.orange[**El intercepto,**] $\hat{\beta_0}$, es el valor predicho de $y$ cuando $x = 0$, aunque en algunos casos no tiene sentido hacer $x = 0$. En estas situaciones, $\hat{\beta_0}$ no tiene gran interés por sí misma.


> .green[Es importante recordar que la FRP es algo fijo, pero desconocido, de la población. Dado que la FRM se obtiene a partir de una muestra de datos, con una nueva muestra se obtendrán una pendiente e intercepto diferentes.]



---



name: fija
class: inverse, center, middle

# `r icon("dice-d6")`
# $X_i$ Fija o Aleatoria?
----

.right[
.bottom[
####  [`r icon("bell")`](#menu)
]
]

---

# $X_i$ Fija o Aleatoria?

Al hacer cálculos estadísticos, condicionar sobre los valores muestrales de la variable independiente es lo mismo que tratar a las $x_i$ como fijas en muestras repetidas, lo cual se entiende como sigue:

<br>

- Primero se escogen n valores muestrales para $x_1, x_2, ..., x_n$. (Éstos pueden repetirse.)     - Dados estos valores, se obtiene después una muestra de $y$. 
- A continuación, se obtiene otra muestra de $y$, usando los mismos valores para $x_1, x_2, ..., x_n$. 
- Después se obtiene otra muestra de $y$, usando los mismos $x_1, x_2, ..., x_n$. Y así sucesivamente.


<br>
<br>

.pull-left[

.center[
### La situación de que las $x_i$ sean fijas en muestras repetidas no es muy realista en los contextos no experimentales. 
]
]


.pull-rigth[

.center[.orange[**Por ejemplo,** al muestrear individuos para el caso del salario y la educación, no tiene mucho sentido pensar en elegir de antemano los valores de *educ* y después muestrear individuos que tengan esos determinados niveles de educación.]]

]



---

# $X_i$ Fija o Aleatoria?


> Una vez que se supone que $E(u|x) = 0$, y que se tiene un muestreo aleatorio, **no cambia
nada en los cálculos al tratar a las $x_i$ como no aleatorias o aleatorias.** 

<br>

----

* .orange[Si las variables independientes $X$ son aleatorias, entonces se dice que estamos trabajando con un modelo de regresión lineal probabilístico. Esto significa que la relación entre las variables $X$ e $Y$ es modelada a través de una distribución de probabilidad. 

En este caso, la incertidumbre sobre la relación entre $X$ e $Y$ es representada a través de la varianza de la distribución de probabilidad.]

----


.pull-left[
Si las variables independientes X son aleatorias, entonces se espera que la esperanza condicional $E(u|x)$ sea cero para cualquier valor de x. Esto significa que, dada una variable independiente X, la media de los errores esperados en los valores de Y asociados con ese valor de X es cero. 
]

.pull-right[

> Para decidir si con un análisis de regresión simple se van a obtener estimadores insesgados, es crucial pensar en los términos del supuesto 3.


$$E(u|x) = 0$$

]

---



name: precision
class: inverse, center, middle

# `r icon("dice-d6")`
# Precisión de los estimadores
----

.right[
.bottom[
####  [`r icon("bell")`](#menu)
]
]

---

# Precisión de los estimadores

Los estimadores po MCO tinen algunas propiedades importantes. Por ejemplo son combinaciones lineales de las observaciones de $y_i$. Por ejemplo:

.pull-left[


### Esperanza de $\beta_1$


$$\hat{\beta_1} = \frac{S_{xy}}{S_{xx}} = \sum_{i=1}^{n} c_i y_i$$
donde, 

- $S_{xy}$ es la covarianza entre $x$ y $y$
- $S_{xx}$ es la varianza entre $x$
- $c_i = (x_i - \bar{x}) / S_{xx}$ para $i = 1, 2, ..., n$


Los estimadores $\hat{\beta_0}$ y $\hat{\beta_1}$ son estimadores insesgados de los parámetros $\beta_0$ y $\beta_1$ del modelo.

]



.pull-right[


$$
\begin{align*}
E(\hat{\beta_1}) & = E \left( \sum_{i=1}^{n} c_i y_i\right) = \sum_{i=1}^{n} c_i E(y_i) \\
 & = \sum_{i=1}^{n} c_i (\beta_0 + \beta_1 x_i) \\
 & = \beta_0 \sum_{i=1}^{n} c_i + \beta_1 \sum_{i=1}^{n} c_i x_i
\end{align*}
$$
<br>

.orange[**Por propiedades:**] $\sum_{i=1}^{n} c_i = 0$, dado que el numerador $\sum_{i=1}^{n} (x_i - \bar{x})$ muestra la suma de las desviaciones alrededor de la media, lo cual por propiedades de la varianza es igual a 0.
]


---

# Precisión de los estimadores


.pull-left[


$$
\begin{align*}
E(\hat{\beta_1}) & = E \left( \sum_{i=1}^{n} c_i y_i\right) = \sum_{i=1}^{n} c_i E(y_i) \\
 & = \sum_{i=1}^{n} c_i (\beta_0 + \beta_1 x_i) \\
 & = \beta_0 \sum_{i=1}^{n} c_i + \beta_1 \sum_{i=1}^{n} c_i x_i
\end{align*}
$$

<br>

.orange[**Por propiedades:**] $\sum_{i=1}^{n} c_i = 0$, dado que el numerador $\sum_{i=1}^{n} (x_i - \bar{x})$ muestra la suma de las desviaciones alrededor de la media, lo cual por propiedades de la varianza es igual a 0.
]


.pull-right[


.orange[**Por propiedades:**] $c_i$ ejerce como un ponderador en términos de $x_i$. Si se multiplica el ponderador por $x_i$ y se realiza la sumatoria obligatoriamente será 1.

$$
\begin{align*}
\sum c_i x_i = & \frac{(x_i - \bar{x})} {S_{xx}} x_i = \frac{(x_i - \bar{x})} {\sum (x_i - \bar{x})^2}x_i \\
\sum c_i x_i = & 1
\end{align*}
$$

<br>

.green[**De tal manera:**]

$$
\begin{align*}
E(\hat{\beta_1}) & = \beta_0 \sum_{i=1}^{n} c_i + \beta_1 \sum_{i=1}^{n} c_i x_i \\
& = \beta_0 (0) + \beta_1 (1) \\
& = \beta_1
\end{align*}
$$

]


---

# Precisión de los estimadores


.pull-left[

### Varianza de $\beta_1$


$$
\begin{align*}
Var (\hat{\beta_1}) = & Var \left( \sum_{i=1}^{n} c_i y_i \right) \\
 = & \sum_{i=1}^{n} c_i ^2 Var(y_i)
\end{align*}
$$
Ya que las observaciones $y_i$ son no correlacionadas, por lo que la varianza de la suma es igual a la suma de las varianzas. La varianza de cada término en la suma es $c_i ^2 Var(y_i)$ y hemos supuesto que $Var(y_i) = \sigma^2$.


]

.pull-right[

En consecuencia,

$$
\begin{align*}
Var (\hat{\beta_1}) = & \sigma^2 \sum_{i=1}^{n} c_i^2  \\
 = & \frac{\sigma^2 \sum (x_i - \bar{x})^2}{S^2_{xx}} \\
 = & \frac{\sigma^2}{S_{xx}} 
\end{align*}
$$
Es decir,

$$Var (\hat{\beta_1}) = \frac{\sigma^2}{\sum (x_i - \bar{x})^2}$$


]




---


# Precisión de los estimadores


## Error estándar 

Las estimaciones de mínimos cuadrados son función de los datos muestrales. Pero, como es probable que los datos cambien entre una muestra y otra, los valores estimados cambiarán `ipso facto`.


Se requiere una medida de precisión de los estimadores $\hat{\beta_i}$.


.center[
### En estadística la precisión de un valor estimado se mide por su error estándar (ee)
]



.pull-left[

.orange[**El error estándar** no es otra cosa que la desviación estándar de la distribución muestral del estimador, y la distribución muestral de un estimador es tan sólo una probabilidad o distribución de frecuencias del estimador, es decir, una distribución del conjunto de valores del estimador obtenidos de todas las muestras posibles de igual tamaño de una población dada.]
]

.pull-right[

$$Var (\hat{\beta_1}) = \frac{\sigma^2}{\sum (x_i - \bar{x})^2}$$

$$ee(\hat{\beta_1}) = \sqrt{Var(\hat{\beta_1}}) = \frac{\sigma}{\sqrt{\sum (x_i - \bar{x})^2}}$$

]


---

class: center, middle

# Para el caso de $\hat{\beta_0}$ se sigue el mismo proceso.

---


name: varianza
class: inverse, center, middle

# `r icon("dice-d6")`
# Estimación de $\sigma^2$
----

.right[
.bottom[
####  [`r icon("bell")`](#menu)
]
]

---

# Estimación de $\sigma^2$


Además de estimar $\beta_0$ y $\beta_1$ se requiere un estimado de $\sigma^2$ para probar hipótesis y formar estimados de intervalo pertinentes al modelo de regresión.

> El estimado de $\sigma^2$ se obtiene a partir de la suma de cuadrados del error SCE

$$SCE = \sum_{i=1}^n u_i^2 = \sum_{i=1}^n (y_i - \hat{y_i})^2$$

Sea entonces:

.pull-left[

$$ \hat{\sigma}^2 = \frac{ \sum_{i=1}^n u_i^2 } {n-2} = \frac{SCE}{n-2} = CME$$

donde, $n-2$ son lo grados de libertad necesarios para la estimación del modelo, equivale a $n:$ .green[Num. de Observaciones.] $2:$ .orange[Num. de parámetros estimados] $(\hat{\beta_0},\hat{\beta_1})$.
A lo anterior, se le conoce como el $CME$ **(Cuadrado medio del error).**

]

.pull-right[

### Error estándar de la estimación (o regresión)

$$\hat{\sigma} = \sqrt{CME} = \sqrt{\frac{SCE}{n-2}}$$

No es más que la desviación estándar de los valores $Y$ alrededor de la línea de regresión estimada.

]


---


name: origen
class: inverse, center, middle

# `r icon("dice-d6")`
# Regresión a través del origen
----

.right[
.bottom[
####  [`r icon("bell")`](#menu)
]
]

---

# Regresión a través del origen

En raros casos, se impone la restricción de que, cuando $x = 0$, el valor esperado de $y$ sea cero.

----

Hay ciertas relaciones para las que esto es razonable. Por ejemplo, si el ingreso $(x)$ es cero, entonces la recaudación de impuestos al ingreso $(y)$ deberá ser cero. Además hay ocasiones en las que un modelo que originalmente tiene un intercepto distinto de cero se transforma en un modelo sin intercepto.

$$ \tilde{y} = \tilde{\beta_1} (x)$$
----

----

Se llama regresión a través del origen porque la recta pasa por el punto $x = 0$ y $\tilde{y} = 0$.


$$\tilde{\beta_1} = \frac{\sum_{i=1}^n x_i y_i}{\sum_{i=1}^n x_i^2}$$

---

name: ui
class: inverse, center, middle

# `r icon("dice-d6")`
# Distribución de probabilidad de las perturbaciones $u_i$
----

.right[
.bottom[
####  [`r icon("bell")`](#menu)
]
]

---


# Distribución de probabilidad de las perturbaciones $u_i$

El modelo clásico de regresión lineal normal supone que cada ui está normalmente distribuida
con:

> * Media: $\quad \quad \quad \quad E(u_i) = 0$
> * Varianza: $\quad \quad \quad E(u_i -E(u_i))^2 = E(u_i^2) = \sigma^2$
> * Convarianza: $\quad  cov(u_i, u_j) = E[(u_i -E(u_i))(u_j -E(u_j))] = E(u_iu_j)=0 ; \quad i\neq j$

<br>

**De forma general,**

$$ u_i \sim N(0, \sigma^2)$$
----

ó, dónde $NID$ significa normal e independientemente distribuido.


$$ u_i \sim NID(0, \sigma^2)$$
----


---

# Propiedades de los estimadores de MCO bajo normalidad


> .font150[.orange[**1.**]] Son **insesgados**

> .font150[.orange[**2.**]] Tienen **varianza mínima**. En combinación con 1, esto significa que son estimadores insesgados con varianza mínima, o eficientes.

> .font150[.orange[**3.**]] Presentan **consistencia**; es decir, a medida que el tamaño de la muestra aumenta indefinidamente, los estimadores convergen hacia sus verdaderos valores poblacionales.

> .font150[.orange[**4.**]] $\hat{\beta_0}$ sigue una distribución normal, es decir:  $\hat{\beta_0} \sim N(\beta_0, \sigma^2_\hat{\beta_0})$.

> .font150[.orange[**5.**]] $\hat{\beta_1}$ sigue una distribución normal, es decir:  $\hat{\beta_1} \sim N(\beta_1, \sigma^2_\hat{\beta_1})$.



A propósito, observe que si supone que $u_i \sim N(0, \sigma^2)$, $Y_i$, al ser una función lineal de $u_i$, posee también una distribución normal con una media y una varianza dadas por:

$$Y_i \sim N(\beta_0 + \beta_2X_i, \sigma^2)$$

---



# Actividad en clase


.left-column[

Resulta que te han contratado para dirigir un proyecto en el área de Educación, con la finalidad de caracterizar parte de la población. 

<br>

A continuación hay una guía de como trabajar algunas variables en R de la base de datos de Educación de la Encuesta Nacional de Calidad de Vida.

]


.right-column[


.scroll-box-20[

``` r


library(haven)


Educ = read_dta("Educación.dta")

View(Educ)


hist(Educ$P6167)


library(dplyr)

# Realicemos conteos de la variable P4693:
# ¿Qué medio de transporte utiliza para ir a la institución donde estudia?

Educ %>% 
  count(P4693)


# Realicemos conteos de la variable P5673:
# ¿El establecimiento donde estudia es privado o público?


Educ %>% 
  count(P5673)


# Realicemos conteos conjuntos:

Educ %>% 
  count(P5673,P4693)


# Exploremos ahora las frecuencias relativas, tenemos que calcularlas
# Utilicemos la variable(P8586)
# ¿Usted actualmente estudia?

Educ %>% 
  count(P8586) %>% 
  mutate(Frecuencia = prop.table(n))


# Guardemos lo anterior en un objeto para poder graficarlo

A = Educ %>% 
    count(P8586) %>% 
    mutate(Frecuencia = prop.table(n))+
    mutate()



# Ahora me interes graficar el objeto "A" creado anteriormente


library(ggplot2)
library(labelled)


ggplot( data = A, aes(x= to_factor(P8586), y = Frecuencia)) +
  geom_bar(stat = "identity") +
  labs(x = "¿Usted actualmente estudia?" )
  

```
]

]



---


# Actividad en clase


.left-column[

![](https://media.giphy.com/media/1gdkWME574oWh9ESjc/giphy.gif)

]


.right-column[

Descargue la base de datos del siguiente link: [ECV 2018](http://microdatos.dane.gov.co/index.php/catalog/607/get_microdata)

<br>

* Sección de educación, o salud, o datos de la vivienda, o el módulo que usted quiera.
* Utilice la librería `haven` para cargar la base de datos (tal cual está el código guía)
* Identifique una relación teórica entre las dos variables y estime un modelo de regresión lineal simple.
* Asuma que la muestra que utilizó es la `población`, de tal manera, la estimación anterior es la FRP.
* Realice diferentes remuestreos del tamaño que usted considere y analice la distribución de los $\hat{\beta_i}$
* ¿Qué distribución siguen?


]






---

class: inverse, center, middle
background-color: #122140

.pull-left[

.center[
<br><br>

# Gracias!!!

<br>



### ¿Preguntas?

<br>


```{r qr, echo=FALSE, fig.align="center", out.width="49%"}
knitr::include_graphics("img/qr-code.png")
```


]


]


.pull-right[

<br> 
<br> 
<img style="border-radius: 50%;" src="img/avatar.png"
width="150px"
/>

### [www.joaquibarandica.com](https://www.joaquibarandica.com)

`r icon("envelope")` orlando.joaqui@javerianacali.edu.co

<img src="img/Logo.jpg" width="120%">

]


<br><br><br>









